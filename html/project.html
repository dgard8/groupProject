<DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8"/>
<title>Time of Sunrise</title>
<!--<link rel="stylesheet" type="text/css" href="Project.css">-->
<script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
<script src= "http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script>
$(document).ready(function(){
  $("#button").click(function(){
    console.log("button clicked");
    var timeZoneOffset = new Date().getTimezoneOffset();

    var client = new XMLHttpRequest();
    console.log($("#zipcode").val());
    var url1 = "http://api.zippopotam.us/us/" + $("#zipcode").val();
    client.open("GET", url1, true);
    client.onreadystatechange = function() {
	if(client.readyState == 4) {
	  //alert(client.responseText);
	  //console.log(client.response);
	  var parsedRes = JSON.parse(client.response);	
	  console.log(parsedRes);
	  var lat = parsedRes.places[0].latitude; 
	  var lon = parsedRes.places[0].longitude;

	  //this is where finding the angle code should go
	  var angle = 20;

       	  var url = "http://52.11.78.180:80/gettime";
       	  var myobj = {Name:"testing",Zip:$("#zipcode").val(),Latitude:lat,Longitude:lon,Angle:angle,Date:$("#date").val(),TimeOffset:timeZoneOffset};
       	  jobj = JSON.stringify(myobj);
          console.log(jobj);
          jQuery.ajax({
      	    url: url,
      	    type: "POST",
      	    data: jobj,
      	    dataType: "json",
      	    contentType: "application/json; charset=utf-8",
      	    success: function(){
		console.log("button success");
      	    }
    	  });
        };
    };
    client.send();
  });
});
</script>

</head>

<body>

<div id="title">
<h1>Time of Sunrise</h1>
</div>

<div id="h3title">
<h3>Select Date</h3>
</div>
<input id="date" type="date">

<div id="h3title">
<h3>Enter Zip Code<h3>
</div>
<input id="zipcode" type="text" maxlength="5" value="00000">

<br>
<br>

<div ng-app="myApp" ng-controller="myCtrl">

<button ng-click="getTime()" id="button" type="button">Get the time of Sunrise!</button>
<p>{{sentence}} {{time}}</p>

</div>

<script>
var app = angular.module('myApp', []);
app.controller('myCtrl', function($scope){
    $scope.sentence= "";
    $scope.time= "";
    $scope.getTime = function(){
	$scope.sentence = "The sun will rise at";
	$scope.time = "6:41 AM";
    }
});
</script>

</body>
</html>
